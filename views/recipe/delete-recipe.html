<!doctype html>
<html lang="en" data-bs-theme="auto">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Delete Recipe</title>
  <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
  <div class="album py-5">
    <div class="container">

      <!-- Top buttons -->
      <a class="btn btn-primary" href="/">Home</a>
      <a class="btn btn-primary" href="/recipe-00000001">View All Recipes</a>

      <h3 class="my-3">Delete Recipe</h3>

      <!-- Server message (success / warning / danger) -->
      <% if (msg) { %>
        <div class="alert alert-<%= msgType || 'info' %>"><%= msg %></div>
      <% } %>

      <div class="row row-cols-1 g-3">
        <div class="col">
          <div class="card shadow-sm">
            <div class="card-body">

              <!-- 1) Select a recipe (GET so server can re-render preview) -->
              <form class="row g-3" method="GET" action="/delete-recipe-00000001">
                <div class="col-md-6">
                  <label class="form-label">Select from existing recipes</label>
                  <select class="form-select" name="id" onchange="this.form.submit()">
                    <option value="">-- Select a recipe --</option>
                    <% (recipes || []).forEach(r => { %>
                      <!-- Use model properties directly -->
                      <option value="<%= r.recipeId %>" <%= (selectedId === r.recipeId ? 'selected' : '') %>>
                        <%= r.recipeId %> - <%= r.title %>
                      </option>
                    <% }) %>
                  </select>
                </div>
              </form>

              <hr/>

              <!-- 2) Preview panel -->
              <h6 class="text-muted mb-2">Recipe Preview</h6>
              <div class="border rounded">
                <% if (selected) { %>
                  <div class="p-3 bg-danger text-white rounded-top">
                    <div class="fw-semibold"><%= selected.title %></div>
                    <div class="small">by <%= selected.chef %></div>
                  </div>

                  <div class="p-3 small">
                    <div class="row">
                      <div class="col-md-6">
                        <div><strong>Recipe ID:</strong> <%= selected.recipeId %></div>
                        <div><strong>Meal Type:</strong> <%= selected.mealType %></div>
                        <div><strong>Cuisine:</strong> <%= selected.cuisineType %></div>
                        <div><strong>Ingredients:</strong> <%= Array.isArray(selected.ingredients) ? selected.ingredients.length : 0 %> item(s)</div>
                      </div>
                      <div class="col-md-6">
                        <div><strong>Difficulty:</strong> <%= selected.difficulty %></div>
                        <div><strong>Prep Time:</strong> <%= selected.prepTime %> min</div>
                        <div><strong>Servings:</strong> <%= selected.servings %></div>
                      </div>
                    </div>

                    <div class="alert alert-warning mt-3 mb-0">
                      This recipe will be permanently deleted.
                    </div>
                  </div>
                <% } else { %>
                  <div class="p-3 text-muted">Please select a recipe to see a preview.</div>
                <% } %>
              </div>

              <!-- 3) Confirm + Delete -->
              <form class="mt-3" method="POST" action="/delete-recipe-00000001">
                <!-- Hidden field with the exact recipeId string -->
                <input type="hidden" name="recipeId" value="<%= selected ? selected.recipeId : '' %>"/>

                <div class="form-check mt-2">
                  <input class="form-check-input" type="checkbox" id="confirm" name="confirm"
                         <%= selected ? '' : 'disabled' %>/>
                  <label class="form-check-label text-danger small" for="confirm">
                    I understand this action cannot be undone and I want to permanently delete this recipe.
                  </label>
                </div>

                <div class="d-flex gap-2 mt-3">
                  <a href="/recipe-00000001" class="btn btn-outline-secondary">Back to Recipes</a>
                  <a href="/delete-recipe-00000001" class="btn btn-outline-primary">Reset</a>
                  <button id="deleteBtn" class="btn btn-danger ms-auto" type="submit"
                          <%= selected ? '' : 'disabled' %>>
                    Delete Recipe
                  </button>
                </div>
              </form>

            </div><!-- card-body -->
          </div><!-- card -->
        </div><!-- col -->
      </div><!-- row -->

    </div><!-- container -->
  </div><!-- album -->

  <!-- Enable button only when checkbox is checked -->
  <script>
    (function () {
      const confirmChk = document.getElementById('confirm');
      const delBtn = document.getElementById('deleteBtn');
      if (confirmChk && delBtn) {
        const sync = () => { delBtn.disabled = !confirmChk.checked; };
        confirmChk.addEventListener('change', sync);
        sync();
      }
    })();
  </script>
</body>
</html>
