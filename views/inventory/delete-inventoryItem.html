<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Delete Inventory Item</title>
  <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
  <div class="album py-5">
    <div class="container">

      <!-- Top nav buttons -->
      <a class="btn btn-primary" href="/">Home</a>
      <a class="btn btn-success" href="/inventoryItem-00000001">View Inventory</a>

      <h3 class="my-3 text-danger">Delete Inventory Item</h3>

      <!-- Optional feedback from query params -->
      <% if (msg) { %>
        <div class="alert alert-<%= msgType %>"><%= msg %></div>
      <% } %>

      <div class="row row-cols-1 g-3">
        <div class="col">
          <div class="card shadow-sm">
            <div class="card-body">

              <!-- 1) Choose item (GET) -->
              <form class="row g-3" method="GET" action="/delete-inventoryItem-00000001">
                <div class="col-md-6">
                  <label class="form-label">Select from existing inventory</label>
                  <select class="form-select" name="id" onchange="this.form.submit()">
                    <option value="">-- Select an item --</option>
                    <% inventory.forEach(i => { %>
                      <option value="<%= i.inventoryId %>" <%= selectedId===i.inventoryId ? "selected" : "" %>>
                        #<%= i.inventoryId %> - <%= i.ingredientName %>
                      </option>
                    <% }) %>
                  </select>
                </div>
              </form>

              <!-- 2) Simple preview -->
              <h6 class="mt-4 mb-2">Item Preview</h6>
              <% if (selected) { %>
                <table class="table table-bordered mb-0 bg-white">
                  <tbody>
                    <tr><th style="width: 180px;">ID</th><td><%= selected.inventoryId %></td></tr>
                    <tr><th>Name</th><td><%= selected.ingredientName %></td></tr>
                    <tr><th>Category</th><td><%= selected.category %></td></tr>
                    <tr><th>Location</th><td><%= selected.location || 'Unknown' %></td></tr>
                    <tr><th>Quantity</th><td><%= selected.quantity %> <%= selected.unit %></td></tr>
                    <tr><th>Unit Price</th><td>$<%= Number(selected.cost || 0).toFixed(2) %></td></tr>
                    <tr><th>Expiry</th><td><%= selected.expirationDate || 'N/A' %></td></tr>
                    <tr><th>Supplier</th><td><%= selected.supplier || '-' %></td></tr>
                    <tr><th>Added</th><td><%= selected.createdDate %></td></tr>
                  </tbody>
                </table>
                <div class="alert alert-warning mt-3 mb-0">
                  This item will be permanently deleted!
                </div>
              <% } else { %>
                <div class="text-muted">Please select an item to see the preview.</div>
              <% } %>

              <!-- 3) Confirm & delete (POST) -->
              <form class="mt-3" method="POST" action="/delete-inventoryItem-00000001">
                <input type="hidden" name="itemId" value="<%= selected ? selected.inventoryId : '' %>">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="confirm" name="confirm" <%= selected ? '' : 'disabled' %>>
                  <label class="form-check-label text-danger" for="confirm">
                    I understand this action cannot be undone.
                  </label>
                </div>
                <div class="d-flex gap-2">
                  <a href="/inventoryItem-00000001" class="btn btn-outline-secondary">Back</a>
                  <a href="/delete-inventoryItem-00000001" class="btn btn-outline-primary">Reset</a>
                  <button class="btn btn-danger ms-auto" type="submit" id="deleteBtn" <%= selected ? '' : 'disabled' %>>
                    Delete
                  </button>
                </div>
              </form>

            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // Require checkbox before enabling submit (simple & inline)
    const chk = document.getElementById('confirm');
    const btn = document.getElementById('deleteBtn');
    if (chk && btn) chk.addEventListener('change', () => btn.disabled = !chk.checked);
  </script>
</body>
</html>
